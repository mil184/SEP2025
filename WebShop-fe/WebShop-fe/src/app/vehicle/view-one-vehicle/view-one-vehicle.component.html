<mat-card appearance="outlined" class="page-card">

  <!-- Header -->
  <mat-card-header class="header">
    <mat-icon class="header-icon" aria-hidden="true">directions_car</mat-icon>

    <div class="header-text">
      <mat-card-title>Vehicle details</mat-card-title>
      <mat-card-subtitle *ngIf="vehicle">
        {{ vehicle.brand }} {{ vehicle.model }}
      </mat-card-subtitle>
    </div>

    <span class="spacer"></span>

    <a mat-stroked-button color="primary" [routerLink]="['/vehicles']">
      <mat-icon aria-hidden="true">arrow_back</mat-icon>
      Back
    </a>
  </mat-card-header>

  <mat-divider></mat-divider>

  <mat-card-content>

    <!-- Loading -->
    <div *ngIf="isLoading" class="state-row loading">
      <mat-progress-spinner diameter="28" mode="indeterminate"></mat-progress-spinner>
      <span>Loading vehicle...</span>
    </div>

    <!-- Error -->
    <mat-card *ngIf="!isLoading && error" class="error-card" appearance="outlined">
      <mat-card-content class="state-row">
        <mat-icon aria-hidden="true">error_outline</mat-icon>
        <span>{{ error }}</span>
      </mat-card-content>
    </mat-card>

    <!-- Vehicle -->
    <ng-container *ngIf="!isLoading && !error && vehicle; else notFound">
      <div class="details-grid">

        <div class="info-tile">
          <mat-icon aria-hidden="true">sell</mat-icon>
          <div>
            <div class="label">Brand</div>
            <div class="value">{{ vehicle.brand }}</div>
          </div>
        </div>

        <div class="info-tile">
          <mat-icon aria-hidden="true">directions_car</mat-icon>
          <div>
            <div class="label">Model</div>
            <div class="value">{{ vehicle.model }}</div>
          </div>
        </div>

        <div class="info-tile">
          <mat-icon aria-hidden="true">event</mat-icon>
          <div>
            <div class="label">Year</div>
            <div class="value">{{ vehicle.year }}</div>
          </div>
        </div>

        <div class="info-tile">
          <mat-icon aria-hidden="true">payments</mat-icon>
          <div>
            <div class="label">Price / day</div>
            <div class="value strong">{{ vehicle.pricePerDay }} / day</div>
          </div>
        </div>

      </div>

      <mat-divider class="section-divider"></mat-divider>

      <!-- Reservation -->
      <mat-card class="reservation-card" appearance="outlined">

        <!-- logged in -> show form -->
        <ng-container *ngIf="isLoggedIn; else loginPrompt">

          <mat-card-header class="reservation-header">
            <mat-icon aria-hidden="true" class="reservation-icon">event_available</mat-icon>
            <div class="header-text">
              <mat-card-title>Reserve this vehicle</mat-card-title>
              <mat-card-subtitle>Pick your dates and confirm</mat-card-subtitle>
            </div>
          </mat-card-header>

          <mat-card-content>
            <form [formGroup]="reservationForm" (ngSubmit)="reserve()" class="reservation-form">

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Start date</mat-label>
                <mat-icon matPrefix aria-hidden="true">calendar_today</mat-icon>
                <input matInput type="date" formControlName="startDate" />
                <mat-error *ngIf="reservationForm.get('startDate')?.touched && reservationForm.get('startDate')?.hasError('required')">
                  Start date is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>End date</mat-label>
                <mat-icon matPrefix aria-hidden="true">event</mat-icon>
                <input matInput type="date" formControlName="endDate" />
                <mat-error *ngIf="reservationForm.get('endDate')?.touched && reservationForm.get('endDate')?.hasError('required')">
                  End date is required.
                </mat-error>
              </mat-form-field>

              <button mat-flat-button color="primary" type="submit" [disabled]="reservationForm.invalid" class="reserve-btn">
                <mat-icon aria-hidden="true">check_circle</mat-icon>
                Reserve
              </button>

            </form>
          </mat-card-content>

        </ng-container>

        <!-- NOT logged in -> form invisible (not rendered) -->
        <ng-template #loginPrompt>
          <mat-card-content class="login-prompt">
            <mat-icon aria-hidden="true">lock</mat-icon>
            <div class="login-text">
              <div class="title">Login required</div>
              <div class="subtitle">You must be logged in to make a reservation.</div>
            </div>

            <span class="spacer"></span>

            <a mat-flat-button color="primary" routerLink="/login">
              <mat-icon aria-hidden="true">login</mat-icon>
              Login
            </a>
          </mat-card-content>
        </ng-template>

      </mat-card>
    </ng-container>

    <ng-template #notFound>
      <div *ngIf="!isLoading && !error" class="state-row muted">
        <mat-icon aria-hidden="true">info</mat-icon>
        <span>Vehicle not found.</span>
      </div>
    </ng-template>

  </mat-card-content>

</mat-card>
